<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Sets Explorer - Toutes les √©ditions MTG avec analyse d'investissement</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }

        h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 3em;
            margin-bottom: 15px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #666666;
            font-size: 1.2em;
        }

        .stats-panel {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: #666666;
            margin-top: 8px;
            font-size: 14px;
        }

        .filters-panel {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }

        .filter-title {
            color: #764ba2;
            font-size: 1.5em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            color: #666666;
            font-size: 14px;
            font-weight: 500;
        }

        input, select {
            padding: 10px 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            color: #333333;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        input::placeholder {
            color: #999999;
        }

        button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #ff6ec4, #7873f5);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 110, 196, 0.3);
        }

        .quick-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .quick-filter-btn {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            color: #666666;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
        }

        .quick-filter-btn:hover {
            background: #667eea;
            border-color: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .quick-filter-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .sets-container {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }

        .view-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .view-buttons {
            display: flex;
            gap: 10px;
        }

        .view-btn {
            padding: 8px 15px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            color: #666666;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .view-btn:hover {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .view-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .sets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .sets-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .set-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            position: relative;
        }

        .set-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .set-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .set-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
        }

        .set-name {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .set-code {
            color: #667eea;
            font-size: 14px;
            font-weight: bold;
        }

        .set-type {
            display: inline-block;
            padding: 4px 10px;
            background: #e7f3ff;
            border-radius: 5px;
            color: #4a90e2;
            font-size: 12px;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .set-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            color: #666666;
            font-size: 14px;
        }

        .info-value {
            color: #2c3e50;
            font-weight: 600;
        }

        .investment-score {
            margin-top: 15px;
            padding: 10px;
            background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
            border-radius: 8px;
            border: 1px solid #4caf50;
        }

        .score-label {
            color: #2e7d32;
            font-size: 12px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .score-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .set-list-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e9ecef;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 20px;
            align-items: center;
            transition: all 0.3s;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .set-list-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666666;
        }

        .spinner {
            border: 3px solid #e0e0e0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            border: 2px solid #667eea;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .close-modal:hover {
            color: #333;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .page-btn {
            padding: 8px 12px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            color: #666666;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .page-btn:hover {
            background: #667eea;
            border-color: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .page-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
        }

        /* Nouvelles classes pour les fonctionnalit√©s ajout√©es */
        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }

        .favorite-btn:hover {
            background: #fff3e0;
            border-color: #ff9800;
        }

        .favorite-btn.favorited {
            background: #ff9800;
            border-color: #ff9800;
            color: white;
        }

        .comparison-panel {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid #ff9800;
            display: none;
        }

        .comparison-panel.active {
            display: block;
        }

        .comparison-items {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .comparison-item {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid #e0e0e0;
        }

        .remove-comparison {
            cursor: pointer;
            color: #ff5252;
            font-weight: bold;
        }

        .deck-builder-panel {
            background: linear-gradient(135deg, #e3f2fd, #e8eaf6);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid #2196f3;
        }

        .deck-list {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .deck-card-item {
            background: white;
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .price-alert-btn {
            background: linear-gradient(135deg, #ff9800, #ff5722);
            padding: 8px 16px;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
        }

        .export-btn {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            padding: 10px 20px;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
        }

        .watchlist-panel {
            background: linear-gradient(135deg, #fce4ec, #f8bbd0);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e91e63;
        }

        .watchlist-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .watchlist-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .watchlist-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .price-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 8px;
            font-size: 14px;
        }

        .trend-up {
            color: #4caf50;
        }

        .trend-down {
            color: #f44336;
        }

        .trend-stable {
            color: #ff9800;
        }

        .advanced-search {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #9c27b0;
        }

        .search-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .search-tag {
            background: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            border: 1px solid #9c27b0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .search-tag:hover {
            background: #9c27b0;
            color: white;
        }

        .search-tag.active {
            background: #9c27b0;
            color: white;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .sets-grid {
                grid-template-columns: 1fr;
            }

            .filter-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>üé¥ Magic Sets Explorer</h1>
        <p class="subtitle">Base de donn√©es compl√®te de TOUTES les √©ditions Magic: The Gathering</p>
    </header>

    <!-- Panel de liste de surveillance -->
    <div class="watchlist-panel" id="watchlistPanel" style="display: none;">
        <h3 style="color: #e91e63;">üëÅÔ∏è Ma liste de surveillance</h3>
        <div class="watchlist-items" id="watchlistItems">
            <!-- Les cartes surveill√©es seront ajout√©es ici -->
        </div>
    </div>

    <div class="stats-panel">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalSets">0</div>
                <div class="stat-label">√âditions totales</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="coreCount">0</div>
                <div class="stat-label">Core Sets</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="expansionCount">0</div>
                <div class="stat-label">Extensions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="mastersCount">0</div>
                <div class="stat-label">Masters Sets</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="oldestYear">-</div>
                <div class="stat-label">Plus ancienne</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="newestYear">-</div>
                <div class="stat-label">Plus r√©cente</div>
            </div>
        </div>
    </div>

    <div class="filters-panel">
        <h2 class="filter-title">üîç Recherche de cartes</h2>

        <!-- Recherche avanc√©e -->
        <div class="advanced-search">
            <h3 style="color: #9c27b0; margin-bottom: 10px;">üéØ Recherche avanc√©e</h3>
            <div class="search-tags">
                <div class="search-tag" onclick="toggleSearchTag(this, 'legendary')">L√©gendaires</div>
                <div class="search-tag" onclick="toggleSearchTag(this, 'planeswalker')">Planeswalkers</div>
                <div class="search-tag" onclick="toggleSearchTag(this, 'artifact')">Artefacts</div>
                <div class="search-tag" onclick="toggleSearchTag(this, 'enchantment')">Enchantements</div>
                <div class="search-tag" onclick="toggleSearchTag(this, 'creature')">Cr√©atures</div>
                <div class="search-tag" onclick="toggleSearchTag(this, 'instant')">√âph√©m√®res</div>
                <div class="search-tag" onclick="toggleSearchTag(this, 'sorcery')">Rituels</div>
                <div class="search-tag" onclick="toggleSearchTag(this, 'land')">Terrains</div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px;">
                <input type="number" id="minPrice" placeholder="Prix min (‚Ç¨)" min="0">
                <input type="number" id="maxPrice" placeholder="Prix max (‚Ç¨)" min="0">
                <select id="colorFilter">
                    <option value="">Toutes les couleurs</option>
                    <option value="W">‚ö™ Blanc</option>
                    <option value="U">üîµ Bleu</option>
                    <option value="B">‚ö´ Noir</option>
                    <option value="R">üî¥ Rouge</option>
                    <option value="G">üü¢ Vert</option>
                    <option value="C">‚ö™ Incolore</option>
                    <option value="M">üåà Multicolore</option>
                </select>
                <select id="rarityFilter">
                    <option value="">Toutes les raret√©s</option>
                    <option value="common">‚ö´ Commune</option>
                    <option value="uncommon">‚ö™ Peu commune</option>
                    <option value="rare">üü° Rare</option>
                    <option value="mythic">üü† Mythique</option>
                </select>
            </div>
        </div>

        <div style="background: linear-gradient(135deg, #e3f2fd, #e8eaf6); padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #2196f3;">
            <h3 style="color: #1976d2; margin-bottom: 15px;">üé¥ Rechercher une carte sp√©cifique</h3>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <input type="text" id="cardSearchInput" placeholder="Ex: Black Lotus, Lightning Bolt, Jace..." style="flex: 1; padding: 12px; font-size: 16px;">
                <button onclick="searchSpecificCard()" style="padding: 12px 30px; background: linear-gradient(135deg, #2196f3, #1976d2); font-size: 16px;">
                    üîç Rechercher la carte
                </button>
            </div>
            <div id="cardSearchResults" style="display: none;">
                <!-- Les r√©sultats de recherche de cartes appara√Ætront ici -->
            </div>
        </div>

        <!-- Panel de construction de deck -->
        <div class="deck-builder-panel" id="deckBuilderPanel" style="display: none;">
            <h3 style="color: #2196f3;">üèóÔ∏è Constructeur de deck</h3>
            <div>
                <input type="text" id="deckName" placeholder="Nom du deck..." style="width: 100%; margin-bottom: 10px;">
                <div class="deck-list" id="deckList">
                    <!-- Les cartes du deck seront list√©es ici -->
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                    <div>
                        <strong>Total cartes:</strong> <span id="deckCardCount">0</span> |
                        <strong>Prix estim√©:</strong> <span id="deckTotalPrice">0‚Ç¨</span>
                    </div>
                    <button class="export-btn" onclick="exportDeck()">üì§ Exporter le deck</button>
                </div>
            </div>
        </div>

        <!-- Panel de comparaison -->
        <div class="comparison-panel" id="comparisonPanel">
            <h3 style="color: #ff9800;">üìä Comparaison d'√©ditions</h3>
            <div class="comparison-items" id="comparisonItems">
                <!-- Les √©ditions √† comparer seront list√©es ici -->
            </div>
            <button onclick="compareSelectedSets()" style="margin-top: 15px;">Comparer les √©ditions s√©lectionn√©es</button>
        </div>

        <h2 class="filter-title" style="margin-top: 25px;">üìö Filtres des √©ditions</h2>

        <div class="filter-controls">
            <div class="filter-group">
                <label>Rechercher une √©dition</label>
                <input type="text" id="searchInput" placeholder="Nom ou code de l'√©dition...">
            </div>

            <div class="filter-group">
                <label>Type d'√©dition</label>
                <select id="typeFilter">
                    <option value="">Tous les types</option>
                    <option value="core">Core Sets</option>
                    <option value="expansion">Extensions</option>
                    <option value="masters">Masters</option>
                    <option value="draft_innovation">Draft Innovation</option>
                    <option value="commander">Commander</option>
                    <option value="starter">Starter</option>
                    <option value="box">Box Sets</option>
                    <option value="promo">Promo</option>
                    <option value="funny">Un-sets</option>
                </select>
            </div>

            <div class="filter-group">
                <label>Ann√©e de sortie</label>
                <select id="yearFilter">
                    <option value="">Toutes les ann√©es</option>
                </select>
            </div>

            <div class="filter-group">
                <label>Trier par</label>
                <select id="sortBy">
                    <option value="released_desc">Date (r√©cent ‚Üí ancien)</option>
                    <option value="released_asc">Date (ancien ‚Üí r√©cent)</option>
                    <option value="name_asc">Nom (A ‚Üí Z)</option>
                    <option value="name_desc">Nom (Z ‚Üí A)</option>
                    <option value="cards_desc">Nombre de cartes</option>
                    <option value="investment_desc">Score d'investissement</option>
                </select>
            </div>
        </div>

        <div class="quick-filters">
            <div class="quick-filter-btn" onclick="filterByCategory('reserved')">üìú Avec liste r√©serv√©e</div>
            <div class="quick-filter-btn" onclick="filterByCategory('foil')">‚ú® Avec foils</div>
            <div class="quick-filter-btn" onclick="filterByCategory('digital')">üíª Digital uniquement</div>
            <div class="quick-filter-btn" onclick="filterByCategory('paper')">üìÑ Papier uniquement</div>
            <div class="quick-filter-btn" onclick="filterByCategory('vintage')">üèõÔ∏è Vintage (pre-2000)</div>
            <div class="quick-filter-btn" onclick="filterByCategory('modern')">‚ö° Modern l√©gal</div>
            <div class="quick-filter-btn" onclick="filterByCategory('standard')">üéØ Standard l√©gal</div>
            <div class="quick-filter-btn" onclick="filterByCategory('investment')">üí∞ Top investissement</div>
            <div class="quick-filter-btn" onclick="toggleFavoritesView()">‚≠ê Mes favoris</div>
            <div class="quick-filter-btn" onclick="toggleDeckBuilder()">üèóÔ∏è Constructeur de deck</div>
            <div class="quick-filter-btn" onclick="toggleWatchlist()">üëÅÔ∏è Liste de surveillance</div>
        </div>
    </div>

    <div class="sets-container">
        <div class="view-controls">
            <h2 style="color: #764ba2;">üìö Toutes les √©ditions Magic</h2>
            <div class="view-buttons">
                <div class="view-btn active" onclick="setView('grid')">‚öè Grille</div>
                <div class="view-btn" onclick="setView('list')">‚ò∞ Liste</div>
                <div class="view-btn" onclick="setView('timeline')">üìÖ Timeline</div>
                <div class="view-btn" onclick="setView('investment')">üíé Vue Investissement</div>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Chargement de toutes les √©ditions Magic...</p>
        </div>

        <div id="setsContainer" class="sets-grid">
            <!-- Les √©ditions seront ajout√©es ici -->
        </div>

        <div class="pagination" id="pagination">
            <!-- Pagination sera ajout√©e ici -->
        </div>
    </div>
</div>

<div id="setModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <div id="modalContent"></div>
    </div>
</div>

<script>
    // Configuration et variables globales
    const API_BASE = 'https://api.scryfall.com';
    let allSets = [];
    let filteredSets = [];
    let currentView = 'grid';
    let currentPage = 1;
    const setsPerPage = 24;
    let searchedCards = [];
    let favoriteSets = JSON.parse(localStorage.getItem('favoriteSets') || '[]');
    let watchlistCards = JSON.parse(localStorage.getItem('watchlistCards') || '[]');
    let deckCards = JSON.parse(localStorage.getItem('deckCards') || '[]');
    let comparisonSets = [];
    let activeSearchTags = [];

    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
        loadAllSets();
        setupEventListeners();
        updateWatchlistDisplay();
    });

    // Configuration des √©couteurs d'√©v√©nements
    function setupEventListeners() {
        document.getElementById('searchInput').addEventListener('input', filterSets);
        document.getElementById('typeFilter').addEventListener('change', filterSets);
        document.getElementById('yearFilter').addEventListener('change', filterSets);
        document.getElementById('sortBy').addEventListener('change', sortSets);

        // Recherche de carte avec Enter
        document.getElementById('cardSearchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchSpecificCard();
            }
        });

        // Filtres avanc√©s
        document.getElementById('minPrice').addEventListener('input', filterSets);
        document.getElementById('maxPrice').addEventListener('input', filterSets);
        document.getElementById('colorFilter').addEventListener('change', filterSets);
        document.getElementById('rarityFilter').addEventListener('change', filterSets);
    }

    // Fonctions pour les nouvelles fonctionnalit√©s

    function toggleFavorite(setCode, event) {
        event.stopPropagation();
        const index = favoriteSets.indexOf(setCode);
        if (index > -1) {
            favoriteSets.splice(index, 1);
        } else {
            favoriteSets.push(setCode);
        }
        localStorage.setItem('favoriteSets', JSON.stringify(favoriteSets));
        displaySets();
    }

    function toggleFavoritesView() {
        const btn = event.target;
        btn.classList.toggle('active');

        if (btn.classList.contains('active')) {
            filteredSets = allSets.filter(s => favoriteSets.includes(s.code));
        } else {
            filteredSets = [...allSets];
        }

        currentPage = 1;
        displaySets();
    }

    function toggleDeckBuilder() {
        const panel = document.getElementById('deckBuilderPanel');
        const btn = event.target;
        btn.classList.toggle('active');
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        updateDeckDisplay();
    }

    function toggleWatchlist() {
        const panel = document.getElementById('watchlistPanel');
        const btn = event.target;
        btn.classList.toggle('active');
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    }

    function addToDeck(card) {
        const existingCard = deckCards.find(c => c.id === card.id);
        if (existingCard) {
            existingCard.quantity++;
        } else {
            deckCards.push({ ...card, quantity: 1 });
        }
        localStorage.setItem('deckCards', JSON.stringify(deckCards));
        updateDeckDisplay();
    }

    function removeFromDeck(cardId) {
        const index = deckCards.findIndex(c => c.id === cardId);
        if (index > -1) {
            if (deckCards[index].quantity > 1) {
                deckCards[index].quantity--;
            } else {
                deckCards.splice(index, 1);
            }
        }
        localStorage.setItem('deckCards', JSON.stringify(deckCards));
        updateDeckDisplay();
    }

    function updateDeckDisplay() {
        const deckList = document.getElementById('deckList');
        const deckCardCount = document.getElementById('deckCardCount');
        const deckTotalPrice = document.getElementById('deckTotalPrice');

        let totalCards = 0;
        let totalPrice = 0;

        deckList.innerHTML = deckCards.map(card => {
            const price = parseFloat(card.prices?.usd || 0) * 0.92;
            totalCards += card.quantity;
            totalPrice += price * card.quantity;

            return `
                <div class="deck-card-item">
                    <div>
                        <strong>${card.quantity}x</strong> ${card.name}
                        <span style="color: #666; font-size: 12px;">(${price.toFixed(2)}‚Ç¨)</span>
                    </div>
                    <span class="remove-comparison" onclick="removeFromDeck('${card.id}')">√ó</span>
                </div>
            `;
        }).join('');

        deckCardCount.textContent = totalCards;
        deckTotalPrice.textContent = totalPrice.toFixed(2) + '‚Ç¨';
    }

    function exportDeck() {
        const deckName = document.getElementById('deckName').value || 'Mon Deck MTG';
        let deckText = `// ${deckName}\n// Export√© depuis Magic Sets Explorer\n\n`;

        deckCards.forEach(card => {
            deckText += `${card.quantity} ${card.name}\n`;
        });

        const blob = new Blob([deckText], { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${deckName}.txt`;
        a.click();
    }

    function addToWatchlist(card) {
        if (!watchlistCards.find(c => c.id === card.id)) {
            watchlistCards.push({
                ...card,
                addedDate: new Date().toISOString(),
                initialPrice: parseFloat(card.prices?.usd || 0)
            });
            localStorage.setItem('watchlistCards', JSON.stringify(watchlistCards));
            updateWatchlistDisplay();
        }
    }

    function removeFromWatchlist(cardId) {
        watchlistCards = watchlistCards.filter(c => c.id !== cardId);
        localStorage.setItem('watchlistCards', JSON.stringify(watchlistCards));
        updateWatchlistDisplay();
    }

    function updateWatchlistDisplay() {
        const watchlistItems = document.getElementById('watchlistItems');

        if (watchlistCards.length === 0) {
            watchlistItems.innerHTML = '<p style="color: #666;">Aucune carte dans votre liste de surveillance</p>';
            return;
        }

        watchlistItems.innerHTML = watchlistCards.map(card => {
            const currentPrice = parseFloat(card.prices?.usd || 0) * 0.92;
            const initialPrice = card.initialPrice * 0.92;
            const priceChange = currentPrice - initialPrice;
            const percentChange = (priceChange / initialPrice * 100).toFixed(1);

            const trendClass = priceChange > 0 ? 'trend-up' : priceChange < 0 ? 'trend-down' : 'trend-stable';
            const trendIcon = priceChange > 0 ? 'üìà' : priceChange < 0 ? 'üìâ' : '‚û°Ô∏è';

            return `
                <div class="watchlist-card" onclick="showCardDetails(${JSON.stringify(card).replace(/"/g, '&quot;')})">
                    <div style="font-weight: bold; color: #e91e63;">${card.name}</div>
                    <div style="font-size: 12px; color: #666;">${card.set_name}</div>
                    <div style="margin-top: 10px;">
                        <div style="font-size: 18px; font-weight: bold;">${currentPrice.toFixed(2)}‚Ç¨</div>
                        <div class="price-trend ${trendClass}">
                            ${trendIcon} ${percentChange}%
                        </div>
                    </div>
                    <button onclick="event.stopPropagation(); removeFromWatchlist('${card.id}')"
                            style="margin-top: 10px; background: #f44336; padding: 5px 10px;
                                   color: white; border: none; border-radius: 5px; cursor: pointer;">
                        Retirer
                    </button>
                </div>
            `;
        }).join('');
    }

    function toggleSearchTag(element, tag) {
        element.classList.toggle('active');
        const index = activeSearchTags.indexOf(tag);
        if (index > -1) {
            activeSearchTags.splice(index, 1);
        } else {
            activeSearchTags.push(tag);
        }
    }

    function addToComparison(setCode) {
        if (!comparisonSets.includes(setCode) && comparisonSets.length < 4) {
            comparisonSets.push(setCode);
            updateComparisonPanel();
        }
    }

    function removeFromComparison(setCode) {
        comparisonSets = comparisonSets.filter(c => c !== setCode);
        updateComparisonPanel();
    }

    function updateComparisonPanel() {
        const panel = document.getElementById('comparisonPanel');
        const items = document.getElementById('comparisonItems');

        if (comparisonSets.length === 0) {
            panel.classList.remove('active');
            return;
        }

        panel.classList.add('active');
        items.innerHTML = comparisonSets.map(code => {
            const set = allSets.find(s => s.code === code);
            return `
                <div class="comparison-item">
                    <span>${set.name}</span>
                    <span class="remove-comparison" onclick="removeFromComparison('${code}')">√ó</span>
                </div>
            `;
        }).join('');
    }

    function compareSelectedSets() {
        if (comparisonSets.length < 2) {
            alert('S√©lectionnez au moins 2 √©ditions pour les comparer');
            return;
        }

        const sets = comparisonSets.map(code => allSets.find(s => s.code === code));
        showComparisonModal(sets);
    }

    function showComparisonModal(sets) {
        const modal = document.getElementById('setModal');
        const content = document.getElementById('modalContent');

        content.innerHTML = `
            <h2 style="color: #ff9800; margin-bottom: 20px;">üìä Comparaison des √©ditions</h2>
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #fff3e0, #ffe0b2);">
                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ff9800;">Crit√®re</th>
                            ${sets.map(set => `<th style="padding: 10px; text-align: left; border-bottom: 2px solid #ff9800;">${set.name}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;"><strong>Code</strong></td>
                            ${sets.map(set => `<td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">${set.code.toUpperCase()}</td>`).join('')}
                        </tr>
                        <tr>
                            <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;"><strong>Type</strong></td>
                            ${sets.map(set => `<td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">${formatSetType(set.set_type)}</td>`).join('')}
                        </tr>
                        <tr>
                            <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;"><strong>Date de sortie</strong></td>
                            ${sets.map(set => `<td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">${new Date(set.released_at).toLocaleDateString('fr-FR')}</td>`).join('')}
                        </tr>
                        <tr>
                            <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;"><strong>Nombre de cartes</strong></td>
                            ${sets.map(set => `<td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">${set.card_count || 'N/A'}</td>`).join('')}
                        </tr>
                        <tr>
                            <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;"><strong>Format</strong></td>
                            ${sets.map(set => `<td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">${set.digital ? 'üíª Digital' : 'üìÑ Papier'}</td>`).join('')}
                        </tr>
                        <tr>
                            <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;"><strong>Score d'investissement</strong></td>
                            ${sets.map(set => {
            const color = getInvestmentColor(set.investmentScore);
            return `<td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">
                                    <span style="background: ${color}; color: white; padding: 5px 10px; border-radius: 5px;">
                                        ${set.investmentScore}/100
                                    </span>
                                </td>`;
        }).join('')}
                        </tr>
                    </tbody>
                </table>
            </div>
            <button onclick="comparisonSets = []; updateComparisonPanel(); closeModal();"
                    style="margin-top: 20px; background: #f44336;">
                Effacer la comparaison
            </button>
        `;

        modal.style.display = 'flex';
    }

    // Rechercher une carte sp√©cifique avec filtres avanc√©s
    async function searchSpecificCard() {
        const searchTerm = document.getElementById('cardSearchInput').value.trim();
        if (!searchTerm && activeSearchTags.length === 0) {
            alert('Veuillez entrer le nom d\'une carte ou s√©lectionner des crit√®res');
            return;
        }

        const resultsDiv = document.getElementById('cardSearchResults');
        resultsDiv.style.display = 'block';
        resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Recherche en cours...</p></div>';

        try {
            // Construire la requ√™te avec les filtres
            let query = searchTerm;

            // Ajouter les tags de type
            activeSearchTags.forEach(tag => {
                query += ` t:${tag}`;
            });

            // Ajouter les filtres de couleur
            const colorFilter = document.getElementById('colorFilter').value;
            if (colorFilter) {
                if (colorFilter === 'M') {
                    query += ' c>=2';
                } else {
                    query += ` c:${colorFilter}`;
                }
            }

            // Ajouter le filtre de raret√©
            const rarityFilter = document.getElementById('rarityFilter').value;
            if (rarityFilter) {
                query += ` r:${rarityFilter}`;
            }

            // Ajouter les filtres de prix
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            if (minPrice) {
                query += ` usd>=${(minPrice / 0.92).toFixed(2)}`;
            }
            if (maxPrice) {
                query += ` usd<=${(maxPrice / 0.92).toFixed(2)}`;
            }

            const response = await fetch(`${API_BASE}/cards/search?q=${encodeURIComponent(query)}&unique=prints&order=released`);
            const data = await response.json();

            if (data.object === 'error') {
                resultsDiv.innerHTML = `<p style="color: #d32f2f; padding: 20px;">‚ùå Aucune carte trouv√©e avec ces crit√®res</p>`;
                return;
            }

            searchedCards = data.data;
            displayCardResults(searchedCards);

        } catch (error) {
            resultsDiv.innerHTML = `<p style="color: #d32f2f; padding: 20px;">‚ùå Erreur lors de la recherche: ${error.message}</p>`;
        }
    }

    // Afficher les r√©sultats de recherche de cartes
    function displayCardResults(cards) {
        const resultsDiv = document.getElementById('cardSearchResults');

        // Grouper les cartes par nom unique
        const uniqueCards = {};
        cards.forEach(card => {
            if (!uniqueCards[card.name] ||
                (card.prices?.usd && parseFloat(card.prices.usd) < parseFloat(uniqueCards[card.name].prices?.usd || 999999))) {
                uniqueCards[card.name] = card;
            }
        });

        const uniqueCardsArray = Object.values(uniqueCards).slice(0, 10);

        resultsDiv.innerHTML = `
            <h4 style="color: #1976d2; margin-bottom: 15px;">
                üìä ${cards.length} impressions trouv√©es (${uniqueCardsArray.length} cartes uniques)
            </h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                ${uniqueCardsArray.map(card => createCardSearchResult(card)).join('')}
            </div>
        `;

        // Ajouter les √©v√©nements click
        uniqueCardsArray.forEach(card => {
            const element = document.getElementById(`card-${card.id}`);
            if (element) {
                element.onclick = () => showCardDetails(card);
            }
        });
    }

    // Cr√©er une carte de r√©sultat de recherche
    function createCardSearchResult(card) {
        const usdPrice = parseFloat(card.prices?.usd || 0);
        const eurPrice = (usdPrice * 0.92).toFixed(2);
        const foilPrice = card.prices?.usd_foil ? (parseFloat(card.prices.usd_foil) * 0.92).toFixed(2) : null;

        // Calculer le score d'investissement de la carte
        const investmentInfo = calculateCardInvestment(card);

        const isInWatchlist = watchlistCards.find(c => c.id === card.id);
        const isInDeck = deckCards.find(c => c.id === card.id);

        return `
            <div id="card-${card.id}" style="
                background: white;
                border: 2px solid #e0e0e0;
                border-radius: 12px;
                padding: 15px;
                cursor: pointer;
                transition: all 0.3s;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.15)'; this.style.borderColor='#2196f3';"
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'; this.style.borderColor='#e0e0e0';">

                <div style="font-weight: bold; color: #1976d2; margin-bottom: 8px; font-size: 16px;">
                    ${card.name}
                </div>

                <div style="color: #666; font-size: 13px; margin-bottom: 10px;">
                    ${card.set_name} (${card.set.toUpperCase()})
                </div>

                <div style="background: ${investmentInfo.color}; padding: 5px 8px; border-radius: 5px; margin-bottom: 10px; font-size: 12px; color: white; font-weight: 600;">
                    ${investmentInfo.label}
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="color: #2e7d32; font-size: 20px; font-weight: bold;">
                            ~${eurPrice}‚Ç¨
                        </div>
                        ${foilPrice ? `<div style="color: #888; font-size: 12px;">Foil: ~${foilPrice}‚Ç¨</div>` : ''}
                    </div>
                    <div style="text-align: right;">
                        <div style="color: #f57c00; font-size: 12px;">
                            ${card.rarity === 'mythic' ? 'üü† Mythique' :
            card.rarity === 'rare' ? 'üü° Rare' :
                card.rarity === 'uncommon' ? '‚ö™ Peu commune' :
                    '‚ö´ Commune'}
                        </div>
                    </div>
                </div>

                ${card.reserved ? '<div style="color: #d32f2f; font-size: 11px; margin-top: 8px; font-weight: bold;">üìú LISTE R√âSERV√âE</div>' : ''}

                <div style="display: flex; gap: 5px; margin-top: 10px;">
                    <button onclick="event.stopPropagation(); addToWatchlist(${JSON.stringify(card).replace(/"/g, '&quot;')})"
                            style="flex: 1; padding: 5px; background: ${isInWatchlist ? '#e91e63' : '#ff9800'};
                                   color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                        ${isInWatchlist ? 'üëÅÔ∏è Surveill√©e' : 'üëÅÔ∏è Surveiller'}
                    </button>
                    <button onclick="event.stopPropagation(); addToDeck(${JSON.stringify(card).replace(/"/g, '&quot;')})"
                            style="flex: 1; padding: 5px; background: ${isInDeck ? '#4caf50' : '#2196f3'};
                                   color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                        ${isInDeck ? '‚úÖ Dans le deck' : '‚ûï Au deck'}
                    </button>
                </div>
            </div>
        `;
    }

    // Calculer l'investissement d'une carte
    function calculateCardInvestment(card) {
        const price = parseFloat(card.prices?.usd || 0);
        const age = 2025 - new Date(card.released_at).getFullYear();

        if (card.reserved) {
            return { label: 'üî• INVESTISSEMENT PARFAIT', color: 'linear-gradient(135deg, #ff6b6b, #ff8787)' };
        }
        if (price < 5 && (card.rarity === 'rare' || card.rarity === 'mythic') && age > 5) {
            return { label: 'üíé EXCELLENTE OPPORTUNIT√â', color: 'linear-gradient(135deg, #feca57, #ff9ff3)' };
        }
        if (price < 10 && age > 10) {
            return { label: '‚úÖ BON INVESTISSEMENT', color: 'linear-gradient(135deg, #48dbfb, #0abde3)' };
        }
        if (price > 50) {
            return { label: '‚ö†Ô∏è INVESTISSEMENT √âLEV√â', color: 'linear-gradient(135deg, #ff9800, #ff5722)' };
        }
        return { label: 'üìä √Ä SURVEILLER', color: 'linear-gradient(135deg, #9e9e9e, #757575)' };
    }

    // Afficher les d√©tails d'une carte
    async function showCardDetails(card) {
        const modal = document.getElementById('setModal');
        const content = document.getElementById('modalContent');

        const usdPrice = parseFloat(card.prices?.usd || 0);
        const eurPrice = (usdPrice * 0.92).toFixed(2);
        const foilPrice = card.prices?.usd_foil ? (parseFloat(card.prices.usd_foil) * 0.92).toFixed(2) : null;

        // Rechercher toutes les impressions de cette carte
        let allPrintings = [];
        try {
            const response = await fetch(`${API_BASE}/cards/search?q=!"${card.name}"&unique=prints&order=released`);
            const data = await response.json();
            if (data.data) {
                allPrintings = data.data;
            }
        } catch (error) {
            console.error('Erreur lors de la recherche des impressions:', error);
        }

        const investmentInfo = calculateCardInvestment(card);

        content.innerHTML = `
            <h2 style="color: #1976d2; margin-bottom: 20px;">
                ${card.name}
            </h2>

            <div style="text-align: center; margin: 20px 0;">
                <img src="${card.image_uris?.normal || card.card_faces?.[0]?.image_uris?.normal || ''}"
                     style="width: 100%; max-width: 350px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
            </div>

            <div style="display: grid; gap: 15px; color: #333333; margin-top: 25px;">
                <div style="display: flex; justify-content: space-between;">
                    <span>√âdition actuelle:</span>
                    <span style="font-weight: 600;">${card.set_name} (${card.set.toUpperCase()})</span>
                </div>

                <div style="display: flex; justify-content: space-between;">
                    <span>Type:</span>
                    <span style="font-weight: 600;">${card.type_line}</span>
                </div>

                <div style="display: flex; justify-content: space-between;">
                    <span>Raret√©:</span>
                    <span style="font-weight: 600;">${card.rarity.charAt(0).toUpperCase() + card.rarity.slice(1)}</span>
                </div>

                <div style="display: flex; justify-content: space-between;">
                    <span>Co√ªt de mana:</span>
                    <span style="font-weight: 600;">${card.mana_cost || 'N/A'}</span>
                </div>

                ${card.reserved ? `
                    <div style="display: flex; justify-content: space-between; background: #ffebee; padding: 10px; border-radius: 8px;">
                        <span>üìú Liste r√©serv√©e:</span>
                        <span style="font-weight: 600; color: #d32f2f;">NE SERA JAMAIS R√âIMPRIM√âE</span>
                    </div>
                ` : ''}
            </div>

            <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #e8f5e9, #f1f8e9); border-radius: 10px; border: 1px solid #4caf50;">
                <h3 style="color: #2e7d32; margin-bottom: 15px;">
                    üí∞ Prix et investissement
                </h3>

                <div style="display: grid; gap: 10px;">
                    <div style="display: flex; justify-content: space-between;">
                        <span>Prix normal:</span>
                        <span style="font-weight: bold; color: #2e7d32; font-size: 20px;">~${eurPrice}‚Ç¨</span>
                    </div>
                    ${foilPrice ? `
                        <div style="display: flex; justify-content: space-between;">
                            <span>Prix foil:</span>
                            <span style="font-weight: bold; color: #ff9800; font-size: 20px;">~${foilPrice}‚Ç¨</span>
                        </div>
                    ` : ''}

                    <div style="margin-top: 10px; padding: 10px; background: ${investmentInfo.color}; border-radius: 8px; text-align: center; color: white; font-weight: bold;">
                        ${investmentInfo.label}

// SUITE DU CODE JAVASCRIPT - √Ä COPIER APR√àS LA LIGNE 664 DU FICHIER PRINCIPAL

                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button onclick='addToWatchlist(${JSON.stringify(card).replace(/'/g, "\\'")})'
                        class="price-alert-btn">
                    üëÅÔ∏è Ajouter √† la surveillance
                </button>
                <button onclick='addToDeck(${JSON.stringify(card).replace(/'/g, "\\'")})'
                        style="background: linear-gradient(135deg, #2196f3, #1976d2); padding: 8px 16px;
                               color: white; border: none; border-radius: 6px; cursor: pointer;">
                    ‚ûï Ajouter au deck
                </button>
            </div>

            ${allPrintings.length > 1 ? `
                <div style="margin-top: 25px;">
                    <h3 style="color: #1976d2; margin-bottom: 15px;">
                        üìö Toutes les impressions (${allPrintings.length})
                    </h3>
                    <div style="max-height: 200px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px; padding: 10px;">
                        ${allPrintings.map(print => {
            const printPrice = print.prices?.usd ? (parseFloat(print.prices.usd) * 0.92).toFixed(2) : 'N/A';
            return `
                                <div style="padding: 8px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between;">
                                    <span>${print.set_name} (${new Date(print.released_at).getFullYear()})</span>
                                    <span style="font-weight: 600; color: #2e7d32;">~${printPrice}‚Ç¨</span>
                                </div>
                            `;
        }).join('')}
                    </div>
                </div>
            ` : ''}

            <div style="margin-top: 25px;">
                <h3 style="color: #1976d2; margin-bottom: 15px;">üîó Acheter cette carte</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <a href="${card.purchase_uris?.cardmarket || 'https://www.cardmarket.com/'}"
                       target="_blank"
                       style="padding: 10px 20px; background: linear-gradient(135deg, #2196f3, #1976d2); color: white; text-decoration: none; border-radius: 8px;">
                        CardMarket EU
                    </a>
                    <a href="${card.purchase_uris?.tcgplayer || '#'}"
                       target="_blank"
                       style="padding: 10px 20px; background: linear-gradient(135deg, #4caf50, #8bc34a); color: white; text-decoration: none; border-radius: 8px;">
                        TCGPlayer US
                    </a>
                    <a href="${card.scryfall_uri}"
                       target="_blank"
                       style="padding: 10px 20px; background: linear-gradient(135deg, #ff9800, #ff5722); color: white; text-decoration: none; border-radius: 8px;">
                        Voir sur Scryfall
                    </a>
                </div>
            </div>
        `;

        modal.style.display = 'flex';
    }

    // Charger toutes les √©ditions
    async function loadAllSets() {
        showLoading(true);

        try {
            const response = await fetch(`${API_BASE}/sets`);
            const data = await response.json();

            allSets = data.data;

            // Enrichir les donn√©es avec des scores d'investissement
            allSets = allSets.map(set => ({
                ...set,
                investmentScore: calculateInvestmentScore(set)
            }));

            // Trier par date de sortie (plus r√©cent en premier)
            allSets.sort((a, b) => new Date(b.released_at || 0) - new Date(a.released_at || 0));

            filteredSets = [...allSets];

            // Remplir le filtre des ann√©es
            populateYearFilter();

            // Mettre √† jour les statistiques
            updateStatistics();

            // Afficher les √©ditions
            displaySets();

        } catch (error) {
            console.error('Erreur lors du chargement des √©ditions:', error);
            document.getElementById('setsContainer').innerHTML =
                '<p style="color: #ff6b6b; text-align: center;">Erreur lors du chargement des donn√©es</p>';
        } finally {
            showLoading(false);
        }
    }

    // Calculer le score d'investissement d'une √©dition
    function calculateInvestmentScore(set) {
        let score = 0;

        // √Çge de l'√©dition
        const releaseYear = new Date(set.released_at).getFullYear();
        const age = 2025 - releaseYear;
        if (age > 20) score += 30;
        else if (age > 10) score += 20;
        else if (age > 5) score += 10;

        // Type d'√©dition
        if (set.set_type === 'masters') score += 25;
        if (set.set_type === 'core' && age > 10) score += 15;
        if (set.set_type === 'expansion' && age > 15) score += 20;

        // √âditions sp√©ciales
        if (set.name.toLowerCase().includes('reserved') ||
            set.name.toLowerCase().includes('alpha') ||
            set.name.toLowerCase().includes('beta') ||
            set.name.toLowerCase().includes('unlimited')) {
            score += 40;
        }

        // Nombre de cartes (√©ditions limit√©es)
        if (set.card_count < 100) score += 10;

        // Digital only = moins d'int√©r√™t pour l'investissement
        if (set.digital) score -= 20;

        // Foil only sets
        if (set.foil_only) score += 15;

        return Math.max(0, Math.min(100, score));
    }

    // Remplir le filtre des ann√©es
    function populateYearFilter() {
        const years = [...new Set(allSets
            .map(set => new Date(set.released_at).getFullYear())
            .filter(year => year > 1992)
        )].sort((a, b) => b - a);

        const yearFilter = document.getElementById('yearFilter');
        years.forEach(year => {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year;
            yearFilter.appendChild(option);
        });
    }

    // Mettre √† jour les statistiques
    function updateStatistics() {
        const coreCount = allSets.filter(s => s.set_type === 'core').length;
        const expansionCount = allSets.filter(s => s.set_type === 'expansion').length;
        const mastersCount = allSets.filter(s => s.set_type === 'masters').length;

        const years = allSets
            .map(s => new Date(s.released_at).getFullYear())
            .filter(y => y > 1992);

        document.getElementById('totalSets').textContent = allSets.length;
        document.getElementById('coreCount').textContent = coreCount;
        document.getElementById('expansionCount').textContent = expansionCount;
        document.getElementById('mastersCount').textContent = mastersCount;
        document.getElementById('oldestYear').textContent = Math.min(...years);
        document.getElementById('newestYear').textContent = Math.max(...years);
    }

    // Afficher les √©ditions
    function displaySets() {
        const container = document.getElementById('setsContainer');
        container.className = currentView === 'list' ? 'sets-list' : 'sets-grid';

        // Pagination
        const startIndex = (currentPage - 1) * setsPerPage;
        const endIndex = startIndex + setsPerPage;
        const setsToDisplay = filteredSets.slice(startIndex, endIndex);

        container.innerHTML = '';

        if (currentView === 'timeline') {
            displayTimeline();
        } else if (currentView === 'investment') {
            displayInvestmentView();
        } else {
            setsToDisplay.forEach(set => {
                if (currentView === 'list') {
                    container.appendChild(createSetListItem(set));
                } else {
                    container.appendChild(createSetCard(set));
                }
            });
        }

        // Afficher la pagination
        displayPagination();
    }

    // Afficher la vue investissement
    function displayInvestmentView() {
        const container = document.getElementById('setsContainer');
        container.className = '';

        // Trier par score d'investissement
        const sortedSets = [...filteredSets].sort((a, b) => b.investmentScore - a.investmentScore);

        // Cat√©goriser les √©ditions
        const topInvestments = sortedSets.filter(s => s.investmentScore >= 70);
        const goodInvestments = sortedSets.filter(s => s.investmentScore >= 40 && s.investmentScore < 70);
        const watchList = sortedSets.filter(s => s.investmentScore >= 20 && s.investmentScore < 40);

        container.innerHTML = `
            <div style="margin-bottom: 30px;">
                <h3 style="color: #ff6b6b; margin-bottom: 20px;">üî• TOP Investissements (Score 70+)</h3>
                <div class="sets-grid">
                    ${topInvestments.slice(0, 12).map(set => createInvestmentCard(set)).map(el => el.outerHTML).join('')}
                </div>
            </div>

            <div style="margin-bottom: 30px;">
                <h3 style="color: #ff9800; margin-bottom: 20px;">‚úÖ Bons Investissements (Score 40-70)</h3>
                <div class="sets-grid">
                    ${goodInvestments.slice(0, 12).map(set => createInvestmentCard(set)).map(el => el.outerHTML).join('')}
                </div>
            </div>

            <div style="margin-bottom: 30px;">
                <h3 style="color: #2196f3; margin-bottom: 20px;">üëÅÔ∏è √Ä Surveiller (Score 20-40)</h3>
                <div class="sets-grid">
                    ${watchList.slice(0, 12).map(set => createInvestmentCard(set)).map(el => el.outerHTML).join('')}
                </div>
            </div>
        `;

        // Ajouter les √©v√©nements click
        container.querySelectorAll('.set-card').forEach(card => {
            const setCode = card.dataset.setCode;
            const set = allSets.find(s => s.code === setCode);
            if (set) {
                card.onclick = () => showSetDetails(set);
            }
        });
    }

    // Cr√©er une carte d'investissement
    function createInvestmentCard(set) {
        const div = document.createElement('div');
        div.className = 'set-card';
        div.dataset.setCode = set.code;

        const releaseDate = new Date(set.released_at);
        const age = 2025 - releaseDate.getFullYear();

        div.innerHTML = `
            <div style="background: ${getInvestmentColor(set.investmentScore)};
                        padding: 10px; margin: -20px -20px 15px -20px;
                        border-radius: 15px 15px 0 0; text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: white;">
                    ${set.investmentScore}%
                </div>
                <div style="color: white; font-size: 14px;">Score d'investissement</div>
            </div>

            <div class="set-name">${set.name}</div>
            <div class="set-code">${set.code.toUpperCase()}</div>

            <div style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 8px;">
                <div style="font-size: 12px; color: #666; margin-bottom: 5px;">
                    üìÖ √Çge: ${age} ans | üìä ${set.card_count || 'N/A'} cartes
                </div>
                <div style="font-size: 12px; color: #666;">
                    Type: ${formatSetType(set.set_type)}
                </div>
            </div>

            ${set.investmentScore >= 70 ?
            '<div style="margin-top: 10px; padding: 5px; background: linear-gradient(135deg, #ff6b6b, #ff8787); color: white; border-radius: 5px; text-align: center; font-weight: bold;">üî• INVESTISSEMENT PREMIUM</div>' :
            set.investmentScore >= 40 ?
                '<div style="margin-top: 10px; padding: 5px; background: linear-gradient(135deg, #ff9800, #ff5722); color: white; border-radius: 5px; text-align: center; font-weight: bold;">‚úÖ BON POTENTIEL</div>' :
                '<div style="margin-top: 10px; padding: 5px; background: linear-gradient(135deg, #2196f3, #1976d2); color: white; border-radius: 5px; text-align: center; font-weight: bold;">üëÅÔ∏è √Ä SURVEILLER</div>'
        }
        `;

        return div;
    }

    // Cr√©er une carte d'√©dition
    function createSetCard(set) {
        const div = document.createElement('div');
        div.className = 'set-card';

        const releaseDate = new Date(set.released_at);
        const formattedDate = releaseDate.toLocaleDateString('fr-FR', {
            year: 'numeric',
            month: 'short'
        });

        const setIcon = getSetIcon(set.set_type);
        const investmentColor = getInvestmentColor(set.investmentScore);
        const isFavorite = favoriteSets.includes(set.code);

        div.innerHTML = `
            <div class="favorite-btn ${isFavorite ? 'favorited' : ''}"
                 onclick="toggleFavorite('${set.code}', event)">
                ${isFavorite ? '‚≠ê' : '‚òÜ'}
            </div>

            <div class="set-header">
                <div>
                    <div class="set-name">${set.name}</div>
                    <div class="set-code">${set.code.toUpperCase()}</div>
                </div>
                <div class="set-icon">${setIcon}</div>
            </div>

            <div class="set-type">${formatSetType(set.set_type)}</div>

            <div class="set-info">
                <div class="info-row">
                    <span>Date de sortie</span>
                    <span class="info-value">${formattedDate}</span>
                </div>
                <div class="info-row">
                    <span>Nombre de cartes</span>
                    <span class="info-value">${set.card_count || 'N/A'}</span>
                </div>
                <div class="info-row">
                    <span>Format</span>
                    <span class="info-value">${set.digital ? 'üíª Digital' : 'üìÑ Papier'}</span>
                </div>
                ${set.foil_only ? `
                    <div class="info-row">
                        <span>Sp√©cial</span>
                        <span class="info-value">‚ú® Foil uniquement</span>
                    </div>
                ` : ''}
            </div>

            <div class="investment-score">
                <div class="score-label">Score d'investissement: ${set.investmentScore}/100</div>
                <div class="score-bar">
                    <div class="score-fill" style="width: ${set.investmentScore}%; background: ${investmentColor};"></div>
                </div>
            </div>

            <button onclick="event.stopPropagation(); addToComparison('${set.code}')"
                    style="width: 100%; margin-top: 10px; padding: 8px;
                           background: linear-gradient(135deg, #ff9800, #ff5722);
                           color: white; border: none; border-radius: 6px; cursor: pointer;">
                üìä Comparer
            </button>
        `;

        div.onclick = () => showSetDetails(set);
        return div;
    }

    // Cr√©er un √©l√©ment de liste
    function createSetListItem(set) {
        const div = document.createElement('div');
        div.className = 'set-list-item';

        const releaseDate = new Date(set.released_at);
        const formattedDate = releaseDate.toLocaleDateString('fr-FR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

        const setIcon = getSetIcon(set.set_type);

        div.innerHTML = `
            <div class="set-icon" style="font-size: 32px; width: 60px; height: 60px;">
                ${setIcon}
            </div>

            <div>
                <div class="set-name" style="font-size: 20px; margin-bottom: 8px;">
                    ${set.name} <span style="color: #667eea;">(${set.code.toUpperCase()})</span>
                </div>
                <div style="color: #666;">
                    ${formatSetType(set.set_type)} ‚Ä¢ ${formattedDate} ‚Ä¢
                    ${set.card_count || 'N/A'} cartes ‚Ä¢
                    ${set.digital ? 'Digital' : 'Papier'}
                    ${set.foil_only ? ' ‚Ä¢ ‚ú® Foil uniquement' : ''}
                </div>
            </div>

            <div style="text-align: right;">
                <div style="color: #4caf50; font-size: 24px; font-weight: bold;">
                    ${set.investmentScore}%
                </div>
                <div style="color: #666; font-size: 12px;">
                    Score invest.
                </div>
            </div>
        `;

        div.onclick = () => showSetDetails(set);
        return div;
    }

    // Afficher la timeline
    function displayTimeline() {
        const container = document.getElementById('setsContainer');
        container.className = '';
        container.innerHTML = '<h3 style="color: #764ba2; margin-bottom: 20px;">üìÖ Timeline des √©ditions Magic</h3>';

        // Grouper par ann√©e
        const setsByYear = {};
        filteredSets.forEach(set => {
            const year = new Date(set.released_at).getFullYear();
            if (!setsByYear[year]) setsByYear[year] = [];
            setsByYear[year].push(set);
        });

        // Trier les ann√©es
        const years = Object.keys(setsByYear).sort((a, b) => b - a);

        years.forEach(year => {
            const yearDiv = document.createElement('div');
            yearDiv.style.marginBottom = '30px';

            yearDiv.innerHTML = `
                <h4 style="color: #667eea; font-size: 24px; margin-bottom: 15px;">
                    ${year} (${setsByYear[year].length} √©ditions)
                </h4>
            `;

            const yearGrid = document.createElement('div');
            yearGrid.className = 'sets-grid';

            setsByYear[year].forEach(set => {
                yearGrid.appendChild(createSetCard(set));
            });

            yearDiv.appendChild(yearGrid);
            container.appendChild(yearDiv);
        });
    }

    // Afficher les d√©tails d'une √©dition
    async function showSetDetails(set) {
        const modal = document.getElementById('setModal');
        const content = document.getElementById('modalContent');

        const releaseDate = new Date(set.released_at);
        const formattedDate = releaseDate.toLocaleDateString('fr-FR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

        content.innerHTML = `
            <h2 style="color: #764ba2; margin-bottom: 20px;">
                ${set.name} (${set.code.toUpperCase()})
            </h2>

            ${set.icon_svg_uri ? `
                <div style="text-align: center; margin: 20px 0;">
                    <img src="${set.icon_svg_uri}" style="width: 100px; height: 100px;">
                </div>
            ` : ''}

            <div style="display: grid; gap: 15px; color: #333;">
                <div style="display: flex; justify-content: space-between;">
                    <span>Type d'√©dition:</span>
                    <span style="color: #667eea;">${formatSetType(set.set_type)}</span>
                </div>

                <div style="display: flex; justify-content: space-between;">
                    <span>Date de sortie:</span>
                    <span>${formattedDate}</span>
                </div>

                <div style="display: flex; justify-content: space-between;">
                    <span>Nombre de cartes:</span>
                    <span>${set.card_count || 'N/A'}</span>
                </div>

                <div style="display: flex; justify-content: space-between;">
                    <span>Format:</span>
                    <span>${set.digital ? 'üíª Digital uniquement' : 'üìÑ Papier'}</span>
                </div>

                ${set.foil_only ? `
                    <div style="display: flex; justify-content: space-between;">
                        <span>Particularit√©:</span>
                        <span>‚ú® Foil uniquement</span>
                    </div>
                ` : ''}

                ${set.block ? `
                    <div style="display: flex; justify-content: space-between;">
                        <span>Bloc:</span>
                        <span>${set.block}</span>
                    </div>
                ` : ''}

                ${set.parent_set_code ? `
                    <div style="display: flex; justify-content: space-between;">
                        <span>√âdition parente:</span>
                        <span>${set.parent_set_code.toUpperCase()}</span>
                    </div>
                ` : ''}
            </div>

            <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #e8f5e9, #f1f8e9); border-radius: 10px; border: 1px solid #4caf50;">
                <h3 style="color: #2e7d32; margin-bottom: 15px;">
                    üí∞ Analyse d'investissement
                </h3>

                <div class="score-bar" style="margin-bottom: 15px; height: 15px; background: #e0e0e0; border-radius: 8px;">
                    <div class="score-fill" style="width: ${set.investmentScore}%; height: 100%; background: ${getInvestmentColor(set.investmentScore)};"></div>
                </div>

                <p style="color: #333; line-height: 1.6;">
                    Score: <strong>${set.investmentScore}/100</strong><br>
                    ${getInvestmentAnalysis(set)}
                </p>
            </div>

            <div style="margin-top: 25px;">
                <h3 style="color: #764ba2; margin-bottom: 15px;">üîó Liens utiles</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <a href="${set.scryfall_uri}" target="_blank"
                       style="padding: 10px 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; text-decoration: none; border-radius: 8px;">
                        Voir sur Scryfall
                    </a>
                    ${set.tcgplayer_id ? `
                        <a href="https://www.tcgplayer.com/search/magic/product?productLineName=magic&setName=${encodeURIComponent(set.name)}"
                           target="_blank"
                           style="padding: 10px 20px; background: linear-gradient(135deg, #4caf50, #8bc34a); color: white; text-decoration: none; border-radius: 8px;">
                            Prix TCGPlayer
                        </a>
                    ` : ''}
                    <button onclick="searchCardsFromSet('${set.code}')"
                            style="padding: 10px 20px;">
                        üîç Voir les cartes
                    </button>
                </div>
            </div>
        `;

        modal.style.display = 'flex';
    }

    // Rechercher les cartes d'une √©dition
    async function searchCardsFromSet(setCode) {
        window.open(`https://scryfall.com/sets/${setCode}`, '_blank');
    }

    // Obtenir l'analyse d'investissement
    function getInvestmentAnalysis(set) {
        const score = set.investmentScore;
        const year = new Date(set.released_at).getFullYear();
        const age = 2025 - year;

        let analysis = [];

        if (score >= 80) {
            analysis.push('üî• Excellente opportunit√© d\'investissement');
        } else if (score >= 60) {
            analysis.push('‚úÖ Tr√®s bon potentiel d\'investissement');
        } else if (score >= 40) {
            analysis.push('üìä Potentiel d\'investissement mod√©r√©');
        } else if (score >= 20) {
            analysis.push('‚è∏Ô∏è Investissement √† surveiller');
        } else {
            analysis.push('‚ùå Faible int√©r√™t pour l\'investissement');
        }

        if (age > 20) {
            analysis.push('‚Ä¢ √âdition tr√®s ancienne (20+ ans) - Raret√© croissante');
        } else if (age > 10) {
            analysis.push('‚Ä¢ √âdition ancienne (10+ ans) - Offre limit√©e');
        }

        if (set.set_type === 'masters') {
            analysis.push('‚Ä¢ Masters set - Reprints de valeur, tirage limit√©');
        }

        if (set.foil_only) {
            analysis.push('‚Ä¢ Foil uniquement - Premium collector');
        }

        if (set.digital) {
            analysis.push('‚Ä¢ Digital uniquement - Pas de valeur physique');
        }

        if (set.card_count < 100) {
            analysis.push('‚Ä¢ √âdition limit√©e - Peu de cartes disponibles');
        }

        return analysis.join('<br>');
    }

    // Filtrer les √©ditions
    function filterSets() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const typeFilter = document.getElementById('typeFilter').value;
        const yearFilter = document.getElementById('yearFilter').value;

        filteredSets = allSets.filter(set => {
            // Recherche textuelle
            if (searchTerm && !set.name.toLowerCase().includes(searchTerm) &&
                !set.code.toLowerCase().includes(searchTerm)) {
                return false;
            }

            // Filtre par type
            if (typeFilter && set.set_type !== typeFilter) {
                return false;
            }

            // Filtre par ann√©e
            if (yearFilter && new Date(set.released_at).getFullYear() !== parseInt(yearFilter)) {
                return false;
            }

            return true;
        });

        currentPage = 1;
        displaySets();
    }

    // Filtrer par cat√©gorie
    function filterByCategory(category) {
        // Toggle active state
        event.target.classList.toggle('active');

        switch(category) {
            case 'reserved':
                filteredSets = allSets.filter(s =>
                    s.name.toLowerCase().includes('alpha') ||
                    s.name.toLowerCase().includes('beta') ||
                    s.name.toLowerCase().includes('unlimited') ||
                    s.name.toLowerCase().includes('revised') ||
                    s.name.toLowerCase().includes('legends') ||
                    s.name.toLowerCase().includes('antiquities') ||
                    s.name.toLowerCase().includes('arabian')
                );
                break;
            case 'foil':
                filteredSets = allSets.filter(s => s.foil_only);
                break;
            case 'digital':
                filteredSets = allSets.filter(s => s.digital);
                break;
            case 'paper':
                filteredSets = allSets.filter(s => !s.digital);
                break;
            case 'vintage':
                filteredSets = allSets.filter(s => new Date(s.released_at).getFullYear() < 2000);
                break;
            case 'modern':
                filteredSets = allSets.filter(s => {
                    const year = new Date(s.released_at).getFullYear();
                    return year >= 2003;
                });
                break;
            case 'standard':
                filteredSets = allSets.filter(s => {
                    const year = new Date(s.released_at).getFullYear();
                    return year >= 2023;
                });
                break;
            case 'investment':
                filteredSets = allSets.filter(s => s.investmentScore >= 60);
                break;
            default:
                filteredSets = [...allSets];
        }

        currentPage = 1;
        displaySets();
    }

    // Trier les √©ditions
    function sortSets() {
        const sortBy = document.getElementById('sortBy').value;

        switch(sortBy) {
            case 'released_desc':
                filteredSets.sort((a, b) => new Date(b.released_at || 0) - new Date(a.released_at || 0));
                break;
            case 'released_asc':
                filteredSets.sort((a, b) => new Date(a.released_at || 0) - new Date(b.released_at || 0));
                break;
            case 'name_asc':
                filteredSets.sort((a, b) => a.name.localeCompare(b.name));
                break;
            case 'name_desc':
                filteredSets.sort((a, b) => b.name.localeCompare(a.name));
                break;
            case 'cards_desc':
                filteredSets.sort((a, b) => (b.card_count || 0) - (a.card_count || 0));
                break;
            case 'investment_desc':
                filteredSets.sort((a, b) => b.investmentScore - a.investmentScore);
                break;
        }

        displaySets();
    }

    // Afficher la pagination
    function displayPagination() {
        const pagination = document.getElementById('pagination');
        const totalPages = Math.ceil(filteredSets.length / setsPerPage);

        if (totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }

        pagination.innerHTML = '';

        // Bouton pr√©c√©dent
        if (currentPage > 1) {
            const prevBtn = document.createElement('div');
            prevBtn.className = 'page-btn';
            prevBtn.textContent = '‚Üê Pr√©c√©dent';
            prevBtn.onclick = () => {
                currentPage--;
                displaySets();
            };
            pagination.appendChild(prevBtn);
        }

        // Num√©ros de page
        const maxButtons = 7;
        let startPage = Math.max(1, currentPage - 3);
        let endPage = Math.min(totalPages, startPage + maxButtons - 1);

        if (endPage - startPage < maxButtons - 1) {
            startPage = Math.max(1, endPage - maxButtons + 1);
        }

        for (let i = startPage; i <= endPage; i++) {
            const pageBtn = document.createElement('div');
            pageBtn.className = 'page-btn' + (i === currentPage ? ' active' : '');
            pageBtn.textContent = i;
            pageBtn.onclick = () => {
                currentPage = i;
                displaySets();
            };
            pagination.appendChild(pageBtn);
        }

        // Bouton suivant
        if (currentPage < totalPages) {
            const nextBtn = document.createElement('div');
            nextBtn.className = 'page-btn';
            nextBtn.textContent = 'Suivant ‚Üí';
            nextBtn.onclick = () => {
                currentPage++;
                displaySets();
            };
            pagination.appendChild(nextBtn);
        }
    }

    // Changer la vue
    function setView(view) {
        currentView = view;

        // Mettre √† jour les boutons
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');

        displaySets();
    }

    // Utilitaires
    function getSetIcon(setType) {
        const icons = {
            'core': 'üéØ',
            'expansion': 'üó°Ô∏è',
            'masters': 'üëë',
            'draft_innovation': 'üé≤',
            'commander': '‚öîÔ∏è',
            'starter': 'üìö',
            'box': 'üì¶',
            'promo': 'üåü',
            'funny': 'üÉè',
            'memorabilia': 'üèÜ',
            'token': 'ü™ô',
            'default': 'üé¥'
        };
        return icons[setType] || icons.default;
    }

    function formatSetType(type) {
        const types = {
            'core': 'Core Set',
            'expansion': 'Extension',
            'masters': 'Masters',
            'draft_innovation': 'Draft Innovation',
            'commander': 'Commander',
            'starter': 'Starter',
            'box': 'Box Set',
            'promo': 'Promo',
            'funny': 'Un-Set',
            'memorabilia': 'Memorabilia',
            'token': 'Token',
            'alchemy': 'Alchemy',
            'arsenal': 'Arsenal',
            'from_the_vault': 'From the Vault',
            'masterpiece': 'Masterpiece',
            'planechase': 'Planechase',
            'premium_deck': 'Premium Deck',
            'spellbook': 'Spellbook',
            'treasure_chest': 'Treasure Chest',
            'vanguard': 'Vanguard'
        };
        return types[type] || type.charAt(0).toUpperCase() + type.slice(1).replace('_', ' ');
    }

    function getInvestmentColor(score) {
        if (score >= 80) return 'linear-gradient(90deg, #ff6b6b, #ff8787)';
        if (score >= 60) return 'linear-gradient(90deg, #feca57, #ff9ff3)';
        if (score >= 40) return 'linear-gradient(90deg, #48dbfb, #0abde3)';
        if (score >= 20) return 'linear-gradient(90deg, #00d2d3, #01a3a4)';
        return 'linear-gradient(90deg, #b0b0d0, #888)';
    }

    function showLoading(show) {
        document.getElementById('loading').style.display = show ? 'block' : 'none';
    }

    function closeModal() {
        document.getElementById('setModal').style.display = 'none';
    }

    // Fermer la modal en cliquant en dehors
    window.onclick = function(event) {
        const modal = document.getElementById('setModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    }
</script>
</body>
</html>